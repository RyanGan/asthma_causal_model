---
title: "Causal Inference Examples"
author: "Ryan_Gan"
date: "January 19, 2017"
output: html_document
---


## Introduction

This markdown file was created to help me further understand key concepts in causal inference statistics to help in our causal inference papers. Recently (December 2016), Oleg Sofrygin created a pretty awesom package called 'simcausal'. Mark van der Laan (creator of the super learner package), and Romain Neugebauer are also authors on this package. This package makes creation of direceted acyclic graphs (DAGs) in a structural equations modeling (SEM) framework easy. Furthermore, it makes the simulation of data that adhere to your desired DAG very easy as well.  

```{r load libraries}
library(simcausal)
```

Let's start simple. Say you want to determine the effect of binary exposure "X" on binary outcome "Y". Let's create a DAG to show X affecting Y. In DAG terminology, the X and Y variables are sometimes called "nodes". The arrows connecting nodes are called "edges". 
The simcausal package even easily creates the DAG plot. I'm not familiar on all the plot options yet, so my DAGs may look pretty basic.

```{r x y dag}
# using 'simcausal' package, first create an empty DAG using the appropriately
# named DAG.empty function.
d.1 <- DAG.empty()

# now using a SEM framework of notation, we define the relationship between 
# each node of the DAG
d.1 <- d.1 +
  # create node X
  # 'distr' defines the distribution we want to use. In this case, I want
  # a binary categorical variable with an equal distribution of 50% in the 
  # simulated data
  node("X", distr = "rcat.b1", prob = c(0.5, 0.5)) +  
  # create node Y
  # we use a Bernoulli distribution, which is equivalent to a binomial 
  # distribution when all X are independent, identically distribution (iid)
  # and random variables
  node("Y", distr = "rbern",
  # define the relationship between X and Y
  # lets say the baseline probability/risk for Y for unexposed X is ~.50
  # and the odds ratio (relative associatoin) for Y | X = exposed is 
  # roughly 2 times greater
  prob = plogis(0 + 0.69 * X))

# we now need to set the DAG we just created
d.1 <- set.DAG(d.1)

# now that this DAG is set, it's easy to plot
plotDAG(d.1, xjitter = 0, yjitter = 0,
        edge_attrs = list(width = 2, arrow.width = 2, arrow.size = 0.5),
        vertex_attrs = list(size = 24, label.cex = 0.8))

```

The DAG above shows a relationship between X and Y. In more specific "causal inference"" terminology we would say that "X affects Y".

We can also easily simulate data to analyze with the "simcausal" package. 

```{r create data}
# create simulated dataframe of DAG
# DAG option is the dag you want to simulate
# n is the sample size we want to simulate. Here we want 10,000 observatoins
# rndseed is the randomseed. Doesn't matter what number you define, but if you want
# to reproduce your data exactly, use the same seed
d.1_df <-  sim(DAG = d.1, n = 10000, rndseed = 321)


```

Let's run a logistic regression on our simulated data to see if it has the properties we expect. I like to use the 'broom' (David Robinson) and 'tidyverse' (Hadley Wickham) to make data manipulation and output easier to read.

```{r}
library(broom)

mod1 <- tidy(glm(Y~X, data = d.1_df, family="binomial"(link="logit")))
mod1

# Odds ratio for the effect of X on Y
exp(mod1[2,2])

```